{% extends 'companies/base.html' %}

{% block title%} {{product.name}}{% endblock %}
{% block css %}
       .white-text{

         color: #fff;
         cursor: pointer;
        text-decoration: italic;
         
        }
       .amir{
         background-color: rgb(180,5,100);
        }


 {% endblock %}
{% block body %}
<div class="container my-4">
    <div class="row">
    
    <div class="col-md-4">
        <h5 id="tokennamepr{{product.id}}" >{{product.name}}</h5>
        <p><b>Rs.{{product.price}} </b></p>
        <p>{{product.desc}}</p>
        <div class="row">
        <br>
        <br>
        <div id='map' style='width: 400px; height: 300px;'></div>
        <input type="hidden" id="lat" name="latVar" value="{{product.latitude}}">
        <input type="hidden" id="lon" name="lonVar" value="{{product.longitude}}">
        <script>
            var lat=document.getElementById("lat").value;
            var lon=document.getElementById("lon").value;
            mapboxgl.accessToken = 'pk.eyJ1Ijoic2hyZXN0aGFiaWpheTI2IiwiYSI6ImNrNW52bjlxMzFlcmIzbXBsODFoOWo3a2cifQ.6nO2xputQ84oABGz22slZg';
            var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center:[85.31,27.62],
            zoom:15
            });
        </script>
    </div>
    </div>
   
    <div class="row col-md-8">
        <img src="/media/{{product.img}}" width="100%" height="0px"  >
    </div>
    
   
    <div class="row">
        <span id="divpr{{i.id}}" class ="divpr">  
            <button class="btn  white-text waves-effect waves-light amir mt-0 cart ml-automx-3">Book Now</button>
        
            <button id="pr{{i.id}}" class="btn  white-text waves-effect waves-light amir mt-0  cart">Add To Cart</button>
        </span>    
    </div>
    
    

    


    
    </div>


</div>

{% endblock %}

{% block js %}

<script type ="text/javascript">

if(localStorage.getItem('cart') == null){
     var cart = {};
}else
{
  cart = JSON.parse(localStorage.getItem('cart'));
  updcart(cart);
  }
  

$('.divpr').on('click','button.cart',function()
{

var strid = this.id.toString();
if(cart[strid] != undefined){
  nes =cart[strid][0] +1;
  name ="My Item";
  card[strid]=[nes,name];

}else{
  nes=1;
  name = "My Item";
  cart[strid]=[nes,name];
}
updcart(cart);


});

//popovering the cart
$('#popcart').popover();
updpopover(cart);


//popover section
function updpopover(cart)
{
   
   var popstr = "";
   popstr = popstr + "<h5> Cart Items:)</h5><div class='mx-2 my-2'>";
   var z=1;
   for(var item in cart)
   {
     popstr = popstr +"<b>"+z+"</b>.";
     popstr = popstr + document.getElementById('tokenname'+item).innerHTML.slice(0,20) + "...Qty:" + cart[item][0] +'<br>';
     z=z+1;
   }   
   //popstr = popstr + "</div> <a href='/shop/checkout'><button class='btn btn-success' id ='checkout'>Checkout</button></a> <button class='btn btn-success' onclick='clearCart()' id ='clearCart'>Clear Cart</button>"
   document.getElementById('popcart').setAttribute('data-content',popstr);
   $('#popcart').popover('show');


}



function updcart(cart){

  var total = 0;
  for(var item in cart){
    total =total + cart[item][0];
   }
  localStorage.setItem('cart',JSON.stringify(cart));
  document.getElementById('cart').innerHTML = total;
  updpopover(cart);
}


</script>
{% endblock %}




